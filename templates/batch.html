{% extends "base.html" %}
{% block title %}Lote & Treino – KNN{% endblock %}
{% block content %}
<h2 class="text-3xl font-extrabold text-violet-700 mb-6">Treino e Previsões em Lote</h2>

<div class="grid md:grid-cols-2 gap-8">
  <!-- Treino -->
  <section class="card">
    <h3 class="card-title">Treinar modelo</h3>
    <p class="card-text mb-3">Envie o Excel consolidado (.xlsx).</p>

    <form method="post" action="{{ url_for('batch_train') }}" class="space-y-3" enctype="multipart/form-data">
      <label class="label">Excel</label>
      <input type="file" name="excel_file" accept=".xlsx,.xls" class="inp" />
      <p class="text-xs text-zinc-500">Ou informe um caminho (opcional):</p>
      <input name="excel_path" value="{{ current_excel or '' }}" class="inp"/>
      <button class="btn-primary mt-1">Treinar</button>
    </form>

    {% if summary %}
      <div class="mt-4 text-sm bg-violet-50 border border-violet-200 rounded-xl p-3">
        <p>k: <strong>{{ summary.k if summary.k is not none else "-" }}</strong></p>
        {% if summary.cv_best is not none %}
          <p>Métrica ({{ summary.cv_metric }}): <strong>{{ "%.4f"|format(summary.cv_best) }}</strong></p>
        {% endif %}
        <p>Amostras: <strong>{{ summary.n_samples if summary.n_samples is not none else "-" }}</strong></p>
        {% if summary.classes %}
          <p>Classes vistas:</p>
          <pre class="text-xs">{{ summary.classes }}</pre>
        {% endif %}
        {% if summary.note %}<p class="mt-2 text-zinc-600">{{ summary.note }}</p>{% endif %}
      </div>
    {% endif %}
  </section>

  <!-- Lote -->
  <section class="card">
    <h3 class="card-title">Gerar CSV (lote)</h3>
    <p class="card-text mb-3">Cria um CSV com recomendação, confiança, scores e Top-3.</p>

    <form method="post" action="{{ url_for('batch_predict_page') }}" class="space-y-3" enctype="multipart/form-data">
      <label class="label">Excel</label>
      <input type="file" name="excel_file" accept=".xlsx,.xls" class="inp" />
      <p class="text-xs text-zinc-500">Ou informe um caminho (opcional):</p>
      <input name="excel_path" value="{{ current_excel or '' }}" class="inp"/>
      <button class="btn-primary mt-1">Gerar CSV</button>
    </form>

    <p class="text-xs text-zinc-500 mt-3">O arquivo será baixado automaticamente ao finalizar.</p>
  </section>
</div>
{% endblock %}
